<div class="pullmoreComponent">
  <p>{{yield}}</p>
  <p ref:more>加载更多</p>
  <div style='display:{{loadding?"block":"none"}}'>
    <Icon type="loading" color="#0be" size="0.4533rem" center></Icon>
  </div>
</div>

<script>
  import './pullmore.less';
  import { flexible, noflexible } from '../../common/lib/rem.750';
  import Icon from '../svg/icon.sve';

  export default {
    data() {
      return {
        loadding:false,//loadding显示状态
      }
    },
    methods: {
      //计算元素到页面顶部的距离
      offsetTop(ele){
        if(ele.offsetParent.nodeName.toLowerCase()==='body'){
          return ele.offsetTop;
        }else{
          return ele.offsetTop+this.offsetTop(ele.offsetParent);
        }
      }  
    },
    oncreate(){
        flexible();
        //检查“加载更多”按钮是否在在视口内，如果在则初始化就执行一次请求
        console.log(this.refs.more,this.refs.more.offsetTop,this.offsetTop(this.refs.more),window.innerHeight,window.pageYOffset);
        //如果加载更多在视口范围内，则执行执行回调请求数据
        if(this.offsetTop(this.refs.more)<=window.innerWidth+window.pageYOffset){
          setTimeout(()=>{
            //发送事件
            this.fire('request')
          })
          //显示loadding
          this.set({loadding:true})
        }
       
        //监听response事件，隐藏loadding
        this.on('response',()=>{
          this.set({loadding:false})
        })
    },
    components: {
      Icon  
    }
  }
</script>